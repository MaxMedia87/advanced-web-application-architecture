# Advanced Web Application Architecture

(перевод книги Matthias Noback)

## Введение

### 1 Предисловие

Моя последняя книга, «Object Design Style Guide», заканчивается главой 10 — «Руководство по
объектам», в которой показаны характеристики некоторых распространенных типов объектов, таких как контроллеры, сущности,
объекты-значения, репозитории, подписчики событий и т. д. Глава заканчивается. с обзором того, как эти различные типы
объектов находят свое естественное место в наборе архитектурных слоев. Некоторые читатели отметили, что само руководство
не было достаточно подробным, чтобы помочь им использовать эти типы объектов в своих собственных проектах. И некоторые
люди возражали, что архитектурные концепции, кратко описанные в этой главе, не могут быть легко применены к реальным
проектам. Они совершенно правы, последняя глава оказалась скорее тизером, чем трактатом. К сожалению, я не мог придумать
альтернативный ресурс, который я мог бы предоставить этим читателям. На эту тему есть несколько хороших статей и книг,
но они охватывают лишь некоторые шаблоны и архитектурные концепции. Насколько я знаю, не существует исчерпывающего
руководства по всем этим шаблонам вместе взятым. Поэтому я решил написать его сам: демонстрация шаблонов проектирования,
таких как сущности и сервисы приложений, объясняющая, как все они работают вместе в «хорошо спроектированном»
приложении. Однако простое описание существующих шаблонов далеко не так полезно, как демонстрация того, как вы могли бы
изобрести их самостоятельно, просто пытаясь отделить код вашего приложения от окружающей его инфраструктуры. Вот так эта
книга стала руководством по отделению модели предметной области и вариантов использования вашего приложения от
фреймворка, базы данных и так далее.

### 2 Почему отделение от инфраструктуры так важно?

Отделение инфраструктуры от ядра вашего приложения приводит к модели предметной области, которую можно
разработать на основе предметной области. Это также приводит к коду приложения, который очень легко тестировать и
разрабатывать на основе тестирования. Наконец, тесты, как правило, более стабильны и выполняются быстрее, чем обычные
функциональные тесты, вдохновленные фреймворком. Поддержка как проектирования, управляемого предметной областью (DDD),
так и разработки, управляемой тестированием (TDD), уже является отличным атрибутом любой программной системы. Но
отделение инфраструктуры от предметной области путем применения этих шаблонов проектирования дает вам еще два
преимущества. Без большой дополнительной работы вы можете начать использовать стандартный набор слоев (которые мы
назовем <i>Domain, Application, и Infrastructure</i>). Кроме того, вы можете легко пометить несвязанные варианты
использования как
порты, а вспомогательный код реализации — как адаптеры. Использование уровней, портов и адаптеров — отличный способ
стандартизировать вашу высокоуровневую архитектуру, облегчая понимание кода, уход за ним и его дальнейшую разработку. И
большой сюрприз, который я вам сейчас покажу, заключается в том, что, отделив код ядра от кода инфраструктуры, вы
получаете все это бесплатно. Если предполагается, что ваше приложение будет жить дольше, скажем, двух лет, то отделение
от инфраструктуры — это беспроигрышный вариант. Окружающая инфраструктура, такая как фреймворки, удаленные веб-сервисы,
системы хранения и т. д., вероятно, будет меняться с другой скоростью, чем ваша модель предметной области и варианты
использования. Что бы ни происходило в мире технологий, окружающих ваше приложение, это не повлияет на ваш драгоценный
основной код. Оба могут развиваться со своей скоростью. Обновление до следующей версии вашего фреймворка, переход на
другое хранилище или переход на другого платежного провайдера не будут стоить так дорого, как если бы код ядра и
инфраструктуры смешивался. Зависимости от внешнего кода или систем всегда будут изолированы, и если необходимо
внести изменения, вы сразу будете знать, где их сделать. С другой стороны, если предполагается, что ваше приложение не
проживет более двух лет, это может быть веской причиной не интересоваться подходом, представленным в этой книге. Тем не
менее, я видел такое приложение только один или два раза в своей жизни.

### 3 Для кого эта книга?

Эта книга для тебя:

* Если у тебя есть некоторый опыт разработки «вдохновленной фреймворком», то есть вы следуете документации фреймворка
  для
  структурирования веб-приложения или
* Если вы видели какой-то устаревший код, в котором каждая часть кодовой базы знает о каждой другой части, и различные
  проблемы полностью перемешаны вместе, или
* Если вы видели и то, и другое, что вполне вероятно, поскольку эти вещи часто связаны между собой.

Я полагаю, что вы читаете эту книгу, потому что ищете лучшие способы структурировать вещи и избежать беспорядка, в
который неизбежно превращается программный проект. <b><i>Вот моя теория: программное обеспечение всегда становится
беспорядочным, даже если вы следуете всем известным передовым методам разработки программного обеспечения. Но я убежден,
что если вы будете следовать методам, изложенным в этой книге, вам потребуется больше времени, чтобы превратить в
беспорядок, а это уже огромное конкурентное преимущество.</i></b>

### 4 Обзор содержания

Эта книга разделена на три части. <b>В части I («Отключение от инфраструктуры»)</b> мы рассмотрим различные примеры кода
из
устаревшего приложения, в котором смешаны код ядра и инфраструктуры. Узнаем, как:

* Извлечение модели предметной области из кода, который смешивает SQL-запросы с бизнес-решениями (глава 2).
* Извлеките повторно используемую службу приложения из контроллера, который сочетает в себе обработку форм,
  бизнес-логику и запросы к базе данных (глава 4).
* Отделите модель чтения от лежащего в ее основе хранилища данных (глава 3).
* Перепишите классы, использующие расположение службы, в классы, использующие внедрение зависимостей (глава 5).
* Отделяйте то, что нам нужно от внешних сервисов, от того, как мы это получаем (Глава 6).
* Работа с текущим временем и случайными данными независимо от того, как работающее приложение будет получать эту
  информацию (глава 7).

Попутно мы узнаем общие методы рефакторинга для разделения этих проблем. Мы замечаем, как эти методы рефакторинга
приводят к, возможно, уже знакомым шаблонам проектирования, таким как <i>Entities, Value-objects, and Application
services</i>.
Мы заканчиваем эту часть подробным обсуждением валидации, а также того, где и как она должна или может происходить (
глава 8).

<b>Часть II («Принципы организации»)</b> содержит обзор принципов организации, которые можно применить к дизайну
приложения в
архитектурном масштабе.

* Глава 11 представляет собой каталог шаблонов проектирования, которые мы получили в части I. Мы
  рассмотрим их более подробно и добавим некоторые важные нюансы и предложения по реализации.
* В главе 12 показано, как отделение кода ядра от кода инфраструктуры с использованием всех этих шаблонов проектирования
  позволяет сгруппировать
  полученные классы в стандартизированный набор уровней.
* В главе 13 продолжается объяснение того, как вы можете использовать архитектурный стиль под названием «Порты и
  адаптеры» в качестве своего рода наложения для этой
  многоуровневой архитектуры.
* В главе 14 мы рассмотрим возможную стратегию тестирования несвязанных приложений.
* В главе 15 мы подходим к заключению книги.

### 5 Сопутствующий демонстрационный проект

Разумеется, все приемы и принципы проектирования, обсуждаемые в этой книге, проиллюстрированы множеством примеров кода.
Однако эти образцы всегда сокращены, идеализированы и показывают лишь самое существенное. Чтобы получить полное
представление о том, как различные части приложения работают вместе, нам нужен демонстрационный проект. Опять же, не
идеализированный или упрощенный, а реальный проект, запущенный в производство. Люди часто просили о таком проекте, и я
всегда отвечал: я бы хотел поработать над этим, сейчас мне нужно найти время. В этот раз я решил воплотить это в жизнь.
Демонстрационный проект представляет собой исходный код новой платформы "Read with the Author". Это программное
обеспечение работает в производстве. Фактически, вы, возможно, уже использовали это программное обеспечение, если купили
для него билет на Leanpub. Но самое главное качество проекта в том, что он показывает приемы и принципы проектирования
из этой книги на практике. За 5 долларов вы можете изучить исходный код, включая любые его будущие обновления. Перейдите
по [ссылке](https://github.com/Read-with-the-author/read-with-the-author/), чтобы сразу получить доступ.

